<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø°ÙƒÙŠØ© - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ Ù„Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³ Ø§Ù„ØªØ±Ø¨ÙˆÙŠ</title>
    <style>
        body {
            font-family: 'Tajawal', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin: 20px 0;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo {
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
        }

        h1 {
            color: #6c63ff;
            margin: 0;
        }

        .subtitle {
            color: #666;
            margin-top: 5px;
        }

        .voice-container {
            text-align: center;
            margin: 30px 0;
        }

        .voice-btn {
            background: #6c63ff;
            border: none;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            padding: 0;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }

        .voice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(108, 99, 255, 0.3);
        }

        .voice-btn.active {
            background: #ff4757;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        #voiceIcon {
            width: 40px;
            height: 40px;
        }

        #status {
            color: #666;
            margin-top: 15px;
            font-size: 14px;
            min-height: 20px;
        }

        .conversation {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
        }

        .message.user {
            justify-content: flex-start;
        }

        .message.assistant {
            justify-content: flex-end;
        }

        .bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
        }

        .user .bubble {
            background: #e3f2fd;
            border-bottom-left-radius: 5px;
        }

        .assistant .bubble {
            background: #6c63ff;
            color: white;
            border-bottom-right-radius: 5px;
        }

        .error {
            color: #ff4757;
            font-weight: bold;
        }

        .typing-indicator {
            display: inline-block;
            margin-left: 5px;
        }

        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #6c63ff;
            border-radius: 50%;
            margin-right: 3px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="https://via.placeholder.com/80" alt="Ø´Ø¹Ø§Ø± Ø°ÙƒÙŠØ©" class="logo">
            <h1>Ø°ÙƒÙŠØ©</h1>
            <p class="subtitle">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ Ù„Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³ Ø§Ù„ØªØ±Ø¨ÙˆÙŠ</p>
        </header>

        <div class="voice-container">
            <button id="voiceBtn" class="voice-btn">
                <img src="https://via.placeholder.com/40" alt="Ø²Ø± Ø§Ù„ØªØ­Ø¯Ø«" id="voiceIcon">
            </button>
            <p id="status">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„Ù„ØªØ­Ø¯Ø«</p>
        </div>

        <div class="conversation" id="conversation">
            <div class="message assistant">
                <div class="bubble">Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ø°ÙƒÙŠØ©ØŒ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³ Ø§Ù„ØªØ±Ø¨ÙˆÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        const voiceBtn = document.getElementById('voiceBtn');
        const statusEl = document.getElementById('status');
        const conversationEl = document.getElementById('conversation');
        const voiceIcon = document.getElementById('voiceIcon');

        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let isListening = false;
        let recognition;
        const synth = window.speechSynthesis;
        let voices = [];

        // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„ØªØ±Ø¨ÙˆÙŠØ©
        const knowledgeBase = {
            "Ø§Ù„Ø°ÙƒØ§Ø¡": "Ø§Ù„Ø°ÙƒØ§Ø¡ Ù…ÙÙ‡ÙˆÙ… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙŠØ´Ù…Ù„ Ø§Ù„Ù‚Ø¯Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙÙŠØ© ÙˆØ§Ù„Ø¹Ø§Ø·ÙÙŠØ© ÙˆØ§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©. Ø­Ø³Ø¨ Ù†Ø¸Ø±ÙŠØ© Ø¬Ø§Ø±Ø¯Ù†Ø± Ù„Ù„Ø°ÙƒØ§Ø¡Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© ÙŠÙˆØ¬Ø¯ 8 Ø£Ù†ÙˆØ§Ø¹ Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡.",
            "Ù†Ø¸Ø±ÙŠØ© Ø¬Ø§Ø±Ø¯Ù†Ø±": "Ù†Ø¸Ø±ÙŠØ© Ø§Ù„Ø°ÙƒØ§Ø¡Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© ØªØ­Ø¯Ø¯ 8 Ø£Ù†ÙˆØ§Ø¹: Ù„ØºÙˆÙŠØŒ Ù…Ù†Ø·Ù‚ÙŠ-Ø±ÙŠØ§Ø¶ÙŠØŒ Ù…ÙƒØ§Ù†ÙŠØŒ Ø¬Ø³Ø¯ÙŠ-Ø­Ø±ÙƒÙŠØŒ Ù…ÙˆØ³ÙŠÙ‚ÙŠØŒ Ø¨ÙŠÙ† Ø´Ø®ØµÙŠØŒ Ø¯Ø§Ø®Ù„ Ø´Ø®ØµÙŠØŒ ÙˆØ·Ø¨ÙŠØ¹ÙŠ.",
            "Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ": "Ù‡Ùˆ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ ÙÙ‡Ù… ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙˆØ§Ø·Ù Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØ¹ÙˆØ§Ø·Ù Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†. ÙŠØ¹ØªØ¨Ø± Ø¹Ø§Ù…Ù„Ø§Ù‹ Ù…Ù‡Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ÙˆØ§Ù„Ù…Ù‡Ù†ÙŠ.",
            "Ø§Ù„ØªØ¹Ù„Ù…": "Ø£ÙØ¶Ù„ Ø·Ø±Ù‚ Ø§Ù„ØªØ¹Ù„Ù… ØªØ´Ù…Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø© Ø§Ù„Ù…ÙˆØ²Ø¹Ø©ØŒ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°Ø§ØªÙŠØŒ ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.",
            "Ø§Ù„ØªØ±Ø¨ÙŠØ©": "Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙØ¹Ø§Ù„Ø© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ÙÙ‡Ù… Ø§Ù„ÙØ±ÙˆÙ‚ Ø§Ù„ÙØ±Ø¯ÙŠØ© ÙÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡ ÙˆØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© ØªØ¹Ù„Ù… ØºÙ†ÙŠØ© ØªØ­ÙØ² Ù…Ø®ØªÙ„Ù Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡."
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ
        function initSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                showError("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ");
                return null;
            }

            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'ar-SA';
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                isListening = true;
                updateUI();
                showStatus("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...");
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.trim();
                handleUserInput(transcript);
            };

            recognition.onerror = (event) => {
                showError("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª: " + event.error);
                resetState();
            };

            recognition.onend = () => {
                if (isListening) {
                    recognition.start();
                }
            };

            return recognition;
        }

        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function handleUserInput(input) {
            addMessage(input, 'user');
            showTypingIndicator();
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            hideTypingIndicator();
            const response = generateResponse(input);
            addMessage(response, 'assistant');
            await speak(response);
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        function generateResponse(input) {
            input = input.toLowerCase();
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙØ¶Ù„ ØªØ·Ø§Ø¨Ù‚ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©
            for (const [keyword, response] of Object.entries(knowledgeBase)) {
                if (input.includes(keyword.toLowerCase())) {
                    return response;
                }
            }
            
            // Ø§Ù„Ø±Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            const defaultResponses = [
                "ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø¤Ø§Ù„ÙŠ Ø¹Ù† Ù†Ø¸Ø±ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø£Ùˆ Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„ÙØ¹Ø§Ù„Ø©",
                "Ø£Ù†Ø§ Ù…ØªØ®ØµØµØ© ÙÙŠ Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³ Ø§Ù„ØªØ±Ø¨ÙˆÙŠ. Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠØŸ",
                "Ø£Ø³Ø¹Ø¯ Ø¨Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù† Ø£Ø³Ø¦Ù„ØªÙƒ ÙÙŠ Ù…Ø¬Ø§Ù„ Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³ Ø§Ù„ØªØ±Ø¨ÙˆÙŠ ÙˆØªÙ†Ù…ÙŠØ© Ø§Ù„Ø°ÙƒØ§Ø¡"
            ];
            
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ­Ø¯Ø«
        function speak(text) {
            return new Promise((resolve) => {
                synth.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ar-SA';
                utterance.rate = 0.85;
                utterance.pitch = 1.1;
                
                // Ø§Ø®ØªÙŠØ§Ø± Ø£ÙØ¶Ù„ ØµÙˆØª Ø¹Ø±Ø¨ÙŠ
                const arabicVoices = voices.filter(v => v.lang.includes('ar'));
                if (arabicVoices.length > 0) {
                    utterance.voice = arabicVoices.find(v => v.name.includes('Female')) || arabicVoices[0];
                }
                
                utterance.onend = resolve;
                synth.speak(utterance);
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = `<div class="bubble">${text}</div>`;
            conversationEl.appendChild(messageDiv);
            scrollToBottom();
        }

        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function showStatus(text, isError = false) {
            statusEl.textContent = text;
            statusEl.className = isError ? 'error' : '';
        }

        function showError(text) {
            showStatus(text, true);
            setTimeout(() => showStatus("Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„Ù„ØªØ­Ø¯Ø«"), 3000);
        }

        // Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="bubble">
                    Ø°ÙƒÙŠØ© ØªÙƒØªØ¨
                    <span class="typing-indicator">
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                    </span>
                </div>
            `;
            conversationEl.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„
        function scrollToBottom() {
            conversationEl.scrollTop = conversationEl.scrollHeight;
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateUI() {
            voiceBtn.classList.toggle('active', isListening);
            voiceIcon.src = isListening ? 
                'https://via.placeholder.com/40/ff4757/ffffff?text=...' : 
                'https://via.placeholder.com/40/6c63ff/ffffff?text=ğŸ¤';
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
        function resetState() {
            isListening = false;
            updateUI();
            showStatus("Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„Ù„ØªØ­Ø¯Ø«");
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        function loadVoices() {
            return new Promise((resolve) => {
                voices = synth.getVoices();
                if (voices.length > 0) {
                    resolve(voices);
                } else {
                    synth.onvoiceschanged = () => {
                        voices = synth.getVoices();
                        resolve(voices);
                    };
                }
            });
        }

        // Ø­Ø¯Ø« Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
        voiceBtn.addEventListener('click', async () => {
            if (!isListening) {
                if (!recognition) {
                    recognition = initSpeechRecognition();
                }
                
                if (recognition) {
                    await loadVoices();
                    recognition.start();
                }
            } else {
                recognition.stop();
                resetState();
            }
        });

        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', async () => {
            await loadVoices();
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­
            if (!('webkitSpeechRecognition' in window) {
                showError("Ø§Ù„Ù…ØªØµÙØ­ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Chrome Ø£Ùˆ Edge");
                voiceBtn.disabled = true;
            } else if (voices.filter(v => v.lang.includes('ar')).length === 0) {
                showError("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙˆØ§Øª Ø¹Ø±Ø¨ÙŠØ© Ù…ØªØ§Ø­Ø©. Ù‚Ø¯ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø§Ù„ØµÙˆØª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
            }
        });
    </script>
</body>
</html>
